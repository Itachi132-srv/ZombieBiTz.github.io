<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zombie Blitz Mobile</title>
<style>
body{margin:0;overflow:hidden;font-family:sans-serif;background:#87ceeb;}
#scoreBoard,#coinsBoard{
  position:absolute;z-index:10;font-size:20px;color:white;
}
#scoreBoard{top:10px;left:10px;}
#coinsBoard{top:10px;right:10px;color:yellow;}
#shopPanel{
  display:none;position:absolute;top:50px;right:10px;width:180px;height:250px;background:#333;color:white;padding:10px;z-index:10;overflow:auto;border-radius:10px;
}
button{padding:10px;margin:5px;font-size:16px;border:none;border-radius:5px;background:#555;color:white;}
#joystickContainer{position:absolute;bottom:20px;left:20px;width:100px;height:100px;z-index:10;}
#fireBtn,#jumpBtn,#grenadeBtn{
  position:absolute;width:60px;height:60px;border-radius:30px;background:red;opacity:0.7;z-index:10;font-size:18px;color:white;border:none;
}
#fireBtn{bottom:30px;right:20px;}
#jumpBtn{bottom:100px;right:20px;}
#grenadeBtn{bottom:170px;right:20px;}
#overlay{
  position:absolute;top:0;left:0;width:100%;height:100%;background:#222;color:white;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:20;
}
#overlay button{font-size:20px;margin:10px;padding:10px 25px;}
</style>
</head>
<body>

<div id="overlay">
  <h1>Zombie Blitz</h1>
  <button onclick="startGame()">Play</button>
  <button onclick="toggleShop()">Shop</button>
</div>

<div id="scoreBoard">Score: 0</div>
<div id="coinsBoard">Coins: 0</div>
<div id="shopPanel">
  <h3>Shop</h3>
  <button onclick="buyGun('Pistol',0)">Pistol (Default)</button><br>
  <button onclick="buyGun('AK47',500)">AK47 - 500 Coins</button><br>
  <button onclick="buyGun('Shotgun',1000)">Shotgun - 1000 Coins</button>
</div>

<div id="joystickContainer"></div>
<button id="fireBtn">Fire</button>
<button id="jumpBtn">Jump</button>
<button id="grenadeBtn">Grenade</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>

<script>
// THREE.js setup
let scene, camera, renderer, controls;
let player={health:100,score:0,coins:0,gun:'Pistol'};
let zombies=[],bullets=[];
let gameStarted=false,wave=1;
let move={forward:0,right:0};

function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x87ceeb);

  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,1.6,5);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light=new THREE.DirectionalLight(0xffffff,1);
  light.position.set(0,50,50);
  scene.add(light);

  const groundGeo=new THREE.BoxGeometry(100,1,100);
  const groundMat=new THREE.MeshStandardMaterial({color:0x228B22});
  const ground=new THREE.Mesh(groundGeo,groundMat);
  ground.position.y=-0.5;
  scene.add(ground);

  controls=new THREE.PointerLockControls(camera,document.body);

  document.addEventListener('click',()=>{if(gameStarted && !controls.isLocked) controls.lock();});

  setInterval(spawnZombie,3000);
  animate();
}

// Joystick using nipplejs
let joystick=nipplejs.create({zone:document.getElementById('joystickContainer'),mode:'static',position:{left:'50px',bottom:'50px'},size:100});
joystick.on('move',(evt, data)=>{
  move.forward=data.vector.y;
  move.right=data.vector.x;
});
joystick.on('end',()=>{move.forward=0;move.right=0;});

// Mobile buttons
document.getElementById('fireBtn').addEventListener('touchstart',shootBullet);
document.getElementById('jumpBtn').addEventListener('touchstart',()=>{camera.position.y+=1;});
document.getElementById('grenadeBtn').addEventListener('touchstart',()=>{alert('Grenade thrown!');});

// Game logic
function spawnZombie(){
  if(!gameStarted) return;
  const geo=new THREE.BoxGeometry(1,2,1);
  const mat=new THREE.MeshStandardMaterial({color:0xff0000});
  const z=new THREE.Mesh(geo,mat);
  z.position.set(Math.random()*50-25,1,Math.random()*50-25);
  z.health=50+wave*10;
  zombies.push(z);
  scene.add(z);
}

function shootBullet(){
  if(!gameStarted) return;
  const geo=new THREE.SphereGeometry(0.1,8,8);
  const mat=new THREE.MeshBasicMaterial({color:0xffff00});
  const b=new THREE.Mesh(geo,mat);
  b.position.copy(camera.position);
  b.direction=new THREE.Vector3();
  camera.getWorldDirection(b.direction);
  bullets.push(b);
  scene.add(b);
}

function animate(){
  requestAnimationFrame(animate);
  if(gameStarted){
    let speed=0.05;
    controls.moveForward(move.forward*speed*-1);
    controls.moveRight(move.right*speed);

    zombies.forEach((z,i)=>{
      const dir=new THREE.Vector3();
      dir.subVectors(camera.position,z.position).normalize();
      z.position.add(dir.multiplyScalar(0.02));
      if(z.position.distanceTo(camera.position)<1){
        player.health-=0.2;
        if(player.health<=0) gameOver();
      }
    });

    bullets.forEach((b,i)=>{
      b.position.add(b.direction.clone().multiplyScalar(0.5));
      zombies.forEach((z,j)=>{
        if(b.position.distanceTo(z.position)<1){
          z.health-=50;
          scene.remove(b);
          bullets.splice(i,1);
          if(z.health<=0){
            player.score+=50;player.coins+=50;
            scene.remove(z);zombies.splice(j,1);
          }
        }
      });
    });

    document.getElementById('scoreBoard').innerText='Score: '+Math.floor(player.score);
    document.getElementById('coinsBoard').innerText='Coins: '+Math.floor(player.coins);
  }
  renderer.render(scene,camera);
}

// Start game
function startGame(){gameStarted=true;player.health=100;document.getElementById('overlay').style.display='none';}

// Shop
function toggleShop(){
  const shop=document.getElementById('shopPanel');
  shop.style.display=shop.style.display==='none'?'block':'none';
}

function buyGun(name,price){
  if(player.coins>=price){player.coins-=price;player.gun=name;alert(name+' equipped!');}
  else alert('Not enough coins!');
}

function gameOver(){
  alert('Game Over! Score: '+Math.floor(player.score));
  gameStarted=false;
  document.getElementById('overlay').style.display='flex';
}

init();
</script>
</body>
</html>
