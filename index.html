<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zombie Blitz 3D</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }
#overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:#222; color:white; display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  z-index:10;
}
button {
  padding:10px 20px; margin:10px; font-size:18px; cursor:pointer;
}
#scoreBoard, #coinsBoard {
  position:absolute; color:white; font-size:20px;
  z-index:5;
}
#scoreBoard { top:10px; left:10px; }
#coinsBoard { top:10px; right:10px; color:yellow; }
#shopPanel {
  display:none; position:absolute; top:50px; right:20px; width:200px; height:300px;
  background:#333; color:white; padding:10px; z-index:6; overflow:auto;
}
</style>
</head>
<body>
<div id="overlay">
  <h1>Zombie Blitz</h1>
  <button onclick="startGame()">Play</button>
  <button onclick="openShop()">Shop</button>
</div>

<div id="scoreBoard">Score: 0</div>
<div id="coinsBoard">Coins: 0</div>

<div id="shopPanel">
  <h3>Shop</h3>
  <button onclick="buyGun('Pistol',0)">Pistol (Default)</button><br>
  <button onclick="buyGun('AK47',500)">AK47 - 500 Coins</button><br>
  <button onclick="buyGun('Shotgun',1000)">Shotgun - 1000 Coins</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let player = {health:100, score:0, coins:0, gun:'Pistol'};
let zombies = [], bullets = [];
let gameStarted = false, wave = 1;

// INIT SCENE
function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,1.6,5);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(0,50,50);
    scene.add(light);

    // Ground
    const groundMat = new THREE.MeshStandardMaterial({color:0x228B22});
    const groundGeo = new THREE.BoxGeometry(100,1,100);
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.position.y=-0.5;
    scene.add(ground);

    // Player controls
    controls = new THREE.PointerLockControls(camera, document.body);

    document.addEventListener('click', () => {
        if(gameStarted && !controls.isLocked) controls.lock();
    });

    // Movement
    document.addEventListener('keydown', keyDown);
    document.addEventListener('keyup', keyUp);

    // Shoot
    document.addEventListener('mousedown', shootBullet);

    animate();
}

// KEYBOARD MOVEMENT
let move = {forward:false, backward:false, left:false, right:false};
function keyDown(e){
    if(e.key==='w') move.forward=true;
    if(e.key==='s') move.backward=true;
    if(e.key==='a') move.left=true;
    if(e.key==='d') move.right=true;
}
function keyUp(e){
    if(e.key==='w') move.forward=false;
    if(e.key==='s') move.backward=false;
    if(e.key==='a') move.left=false;
    if(e.key==='d') move.right=false;
}

// SPAWN ZOMBIE
function spawnZombie() {
    if(!gameStarted) return;
    const geo = new THREE.BoxGeometry(1,2,1);
    const mat = new THREE.MeshStandardMaterial({color:0xff0000});
    const zombie = new THREE.Mesh(geo, mat);
    zombie.position.set(Math.random()*50-25,1,Math.random()*50-25);
    zombie.health = 50 + wave*10;
    zombies.push(zombie);
    scene.add(zombie);
}

// SHOOTING
function shootBullet() {
    if(!gameStarted) return;
    const bulletGeo = new THREE.SphereGeometry(0.1,8,8);
    const bulletMat = new THREE.MeshBasicMaterial({color:0xffff00});
    const bullet = new THREE.Mesh(bulletGeo, bulletMat);
    bullet.position.copy(camera.position);
    bullet.direction = new THREE.Vector3();
    camera.getWorldDirection(bullet.direction);
    bullets.push(bullet);
    scene.add(bullet);
}

// ANIMATE LOOP
function animate() {
    requestAnimationFrame(animate);

    if(gameStarted){
        // Player move
        let speed = 0.1;
        if(move.forward) controls.moveForward(speed);
        if(move.backward) controls.moveForward(-speed);
        if(move.left) controls.moveRight(-speed);
        if(move.right) controls.moveRight(speed);

        // Zombies move
        zombies.forEach((z,i)=>{
            const dir = new THREE.Vector3();
            dir.subVectors(camera.position, z.position).normalize();
            z.position.add(dir.multiplyScalar(0.02));
            if(z.position.distanceTo(camera.position)<1){
                player.health -= 0.2;
                if(player.health<=0){
                    gameOver();
                }
            }
        });

        // Bullets move
        bullets.forEach((b,i)=>{
            b.position.add(b.direction.clone().multiplyScalar(0.5));
            zombies.forEach((z,j)=>{
                if(b.position.distanceTo(z.position)<1){
                    z.health -= 50;
                    scene.remove(b);
                    bullets.splice(i,1);
                    if(z.health<=0){
                        player.score += 50;
                        player.coins += 50;
                        scene.remove(z);
                        zombies.splice(j,1);
                    }
                }
            });
        });

        // Update UI
        document.getElementById('scoreBoard').innerText = 'Score: '+Math.floor(player.score);
        document.getElementById('coinsBoard').innerText = 'Coins: '+Math.floor(player.coins);
    }

    renderer.render(scene,camera);
}

// START GAME
function startGame() {
    gameStarted = true;
    player.health = 100;
    document.getElementById('overlay').style.display='none';
    setInterval(spawnZombie, 3000);
}

// SHOP
function openShop() {
    const shop = document.getElementById('shopPanel');
    shop.style.display = shop.style.display==='none'?'block':'none';
}

// BUY GUN
function buyGun(name,price){
    if(player.coins>=price){
        player.coins-=price;
        player.gun=name;
        alert(name + " equipped!");
    } else {
        alert("Not enough coins!");
    }
}

// GAME OVER
function gameOver(){
    alert("Game Over! Score: "+Math.floor(player.score));
    gameStarted=false;
    document.getElementById('overlay').style.display='flex';
}

init();
</script>
</body>
</html>
